(this["webpackJsonpreact_dynamic-list-of-posts"]=this["webpackJsonpreact_dynamic-list-of-posts"]||[]).push([[0],{17:function(e,t,a){},21:function(e,t,a){},22:function(e,t,a){"use strict";a.r(t);var s=a(8),c=a.n(s),n=a(3),i=a(1),r=a.n(i),o=(a(15),a(16),a(17),a(4)),l=a.n(o),d="https://mate.academy/students-api";function j(e){return new Promise((function(t){setTimeout(t,e)}))}function b(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s={method:t};return a&&(s.body=JSON.stringify(a),s.headers={"Content-Type":"application/json; charset=UTF-8"}),j(300).then((function(){return fetch(d+e,s)})).then((function(e){return e.json()}))}var u,O=function(e){return b(e)},m=function(e,t){return b(e,"POST",t)},h=function(e){return b(e,"DELETE")},p=function(e){return O("/comments?postId=".concat(e))},y=a(10),x=a(2),E=a(9);!function(e){e[e.SET_USERS=0]="SET_USERS",e[e.SET_POSTS=1]="SET_POSTS",e[e.SET_SELECTED_POST=2]="SET_SELECTED_POST",e[e.SET_SELECTED_USER=3]="SET_SELECTED_USER",e[e.SET_COMMENTS=4]="SET_COMMENTS",e[e.IS_LOADING=5]="IS_LOADING",e[e.SHOWFORM=6]="SHOWFORM",e[e.DELETE_COMMENT=7]="DELETE_COMMENT",e[e.SET_ERROR=8]="SET_ERROR"}(u||(u={}));var f=a(0);function S(e,t){var a=Object(E.cloneDeep)(e.comments),s=a.findIndex((function(e){return e.id===t.id}));return a.splice(s,1),a}function N(e,t){switch(t.type){case u.SET_SELECTED_POST:return Object(x.a)(Object(x.a)({},e),{},{selectedPost:t.payload});case u.SET_SELECTED_USER:return Object(x.a)(Object(x.a)({},e),{},{selectedUser:t.payload});case u.SET_COMMENTS:return Object(x.a)(Object(x.a)({},e),{},{comments:t.payload});case u.SET_ERROR:return Object(x.a)(Object(x.a)({},e),{},{error:t.payload});case u.IS_LOADING:return Object(x.a)(Object(x.a)({},e),{},{isLoading:t.payload});case u.SHOWFORM:return Object(x.a)(Object(x.a)({},e),{},{showForm:t.payload});case u.DELETE_COMMENT:return Object(x.a)(Object(x.a)({},e),{},{comments:Object(y.a)(S(e,t.payload))});default:return e}}var T={state:{selectedPost:{},selectedUser:{},comments:[],isLoading:!1,showForm:!1,error:""},dispatch:function(){}},v=r.a.createContext(T),g=function(e){var t=e.children,a=Object(i.useReducer)(N,T.state),s=Object(n.a)(a,2),c=s[0],r=s[1];return Object(f.jsx)(v.Provider,{value:{state:Object(x.a)({},c),dispatch:r},children:t})},_=function(e){var t=e.allUsers,a=e.setPosts,s=Object(i.useState)(!1),c=Object(n.a)(s,2),r=c[0],o=c[1],d=Object(i.useState)("Choose a user"),j=Object(n.a)(d,2),b=j[0],m=j[1],h=Object(i.useContext)(v).dispatch;function p(e){var t;o(!r),h({type:u.IS_LOADING,payload:!0}),m(e.name),h({type:u.SET_SELECTED_USER,payload:e}),(t=e.id,O("/posts?userId=".concat(t))).then((function(e){"error"in e&&h({type:u.SET_ERROR,payload:"error"}),a(e)})).catch((function(){h({type:u.SET_ERROR,payload:"error"})})).finally((function(){return h({type:u.IS_LOADING,payload:!1})})),h({type:u.SET_SELECTED_POST,payload:{}})}function y(){o(!r)}return Object(f.jsxs)("div",{"data-cy":"UserSelector",className:l()("dropdown",{"is-active":r}),children:[Object(f.jsx)("div",{className:"dropdown-trigger",onClick:y,onKeyDown:y,role:"listbox",tabIndex:0,children:Object(f.jsxs)("button",{type:"button",className:"button","aria-haspopup":"true","aria-controls":"dropdown-menu",children:[Object(f.jsx)("span",{children:b}),Object(f.jsx)("span",{className:"icon is-small",children:Object(f.jsx)("i",{className:"fas fa-angle-down","aria-hidden":"true"})})]})}),Object(f.jsx)("div",{className:"dropdown-menu",id:"dropdown-menu",role:"menu",children:Object(f.jsx)("div",{className:"dropdown-content",children:t.map((function(e){return Object(f.jsx)("a",{href:"#user-".concat(e.id),className:"dropdown-item",onClick:function(){return p(e)},children:e.name},e.id)}))})})]})},C=function(e){var t=e.usersPosts,a=Object(i.useContext)(v),s=a.state,c=a.dispatch,r=Object(i.useState)(!1),o=Object(n.a)(r,2),d=o[0],j=o[1];return Object(f.jsxs)("div",{"data-cy":"PostsList",children:[Object(f.jsx)("p",{className:"title",children:"Posts:"}),Object(f.jsxs)("table",{className:"table is-fullwidth is-striped is-hoverable is-narrow",children:[Object(f.jsx)("thead",{children:Object(f.jsxs)("tr",{className:"has-background-link-light",children:[Object(f.jsx)("th",{children:"#"}),Object(f.jsx)("th",{children:"Title"}),Object(f.jsx)("th",{children:" "})]})}),Object(f.jsx)("tbody",{children:t.map((function(e){return Object(f.jsxs)("tr",{"data-cy":"Post",children:[Object(f.jsx)("td",{"data-cy":"PostId",children:e.id}),Object(f.jsx)("td",{"data-cy":"PostTitle",children:e.title}),Object(f.jsx)("td",{className:"has-text-right is-vcentered",children:Object(f.jsx)("button",{type:"button","data-cy":"PostButton",className:l()("button is-link",{"is-light":s.selectedPost.id!==e.id}),onClick:function(){return function(e){j(!d),e.id===s.selectedPost.id?c({type:u.SET_SELECTED_POST,payload:{}}):(c({type:u.SET_SELECTED_POST,payload:e}),c({type:u.SHOWFORM,payload:!1}))}(e)},children:s.selectedPost.id!==e.id?"Open":"Close"})})]},e.id)}))})]})]})},P=function(){var e=Object(i.useContext)(v),t=e.state,a=e.dispatch,s={name:"",body:"",email:"",postId:t.selectedPost.id},c=Object(i.useState)(s),r=Object(n.a)(c,2),o=r[0],d=r[1],j=Object(i.useState)(!1),b=Object(n.a)(j,2),O=b[0],h=b[1],y=Object(i.useState)(!1),E=Object(n.a)(y,2),S=E[0],N=E[1],T=Object(i.useState)(!1),g=Object(n.a)(T,2),_=g[0],C=g[1];return Object(f.jsxs)("form",{"data-cy":"NewCommentForm",onSubmit:function(e){var s;e.preventDefault(),0===o.body.length&&C(!0),0===o.name.length&&h(!0),0===o.email.length&&N(!0),0!==o.body.length&&0!==o.name.length&&0!==o.email.length&&(a({type:u.IS_LOADING,payload:!0}),(s=o,m("/comments",s)).then((function(e){"error"in e&&a({type:u.SET_ERROR,payload:"error"}),p(t.selectedPost.id).then((function(e){a({type:u.SET_COMMENTS,payload:e})}))})).finally((function(){return a({type:u.IS_LOADING,payload:!1})})),d(Object(x.a)(Object(x.a)({},o),{},{body:""})))},children:[Object(f.jsxs)("div",{className:"field","data-cy":"NameField",children:[Object(f.jsx)("label",{className:"label",htmlFor:"comment-author-name",children:"Author Name"}),Object(f.jsxs)("div",{className:"control has-icons-left has-icons-right",children:[Object(f.jsx)("input",{type:"text",name:"name",value:o.name,id:"comment-author-name",placeholder:"Name Surname",className:l()("input",{"is-danger":O}),onChange:function(e){return function(e){e.preventDefault(),e.target.value.split("").every((function(e){return" "===e}))||(d(Object(x.a)(Object(x.a)({},o),{},{name:e.currentTarget.value})),h(!1))}(e)}}),Object(f.jsx)("span",{className:"icon is-small is-left",children:Object(f.jsx)("i",{className:"fas fa-user"})}),O&&Object(f.jsx)("span",{className:"icon is-small is-right has-text-danger","data-cy":"ErrorIcon",children:Object(f.jsx)("i",{className:"fas fa-exclamation-triangle"})})]}),O&&Object(f.jsx)("p",{className:"help is-danger","data-cy":"ErrorMessage",children:"Name is required"})]}),Object(f.jsxs)("div",{className:"field","data-cy":"EmailField",children:[Object(f.jsx)("label",{className:"label",htmlFor:"comment-author-email",children:"Author Email"}),Object(f.jsxs)("div",{className:"control has-icons-left has-icons-right",children:[Object(f.jsx)("input",{type:"text",name:"email",id:"comment-author-email",placeholder:"email@test.com",className:l()("input",{"is-danger":S}),onChange:function(e){return function(e){e.preventDefault(),d(Object(x.a)(Object(x.a)({},o),{},{email:e.currentTarget.value})),N(!1)}(e)}}),Object(f.jsx)("span",{className:"icon is-small is-left",children:Object(f.jsx)("i",{className:"fas fa-envelope"})}),S&&Object(f.jsx)("span",{className:"icon is-small is-right has-text-danger","data-cy":"ErrorIcon",children:Object(f.jsx)("i",{className:"fas fa-exclamation-triangle"})})]}),S&&Object(f.jsx)("p",{className:"help is-danger","data-cy":"ErrorMessage",children:"Email is required"})]}),Object(f.jsxs)("div",{className:"field","data-cy":"BodyField",children:[Object(f.jsx)("label",{className:"label",htmlFor:"comment-body",children:"Comment Text"}),Object(f.jsx)("div",{className:"control",children:Object(f.jsx)("textarea",{id:"comment-body",name:"body",placeholder:"Type comment here",className:l()("textarea",{"is-danger":_}),value:o.body,onChange:function(e){return function(e){e.preventDefault(),d(Object(x.a)(Object(x.a)({},o),{},{body:e.currentTarget.value})),C(!1)}(e)}})}),_&&Object(f.jsx)("p",{className:"help is-danger","data-cy":"ErrorMessage",children:"Enter some text"})]}),Object(f.jsxs)("div",{className:"field is-grouped",children:[Object(f.jsx)("div",{className:"control",children:Object(f.jsx)("button",{type:"submit",className:"button is-link ",children:"Add"})}),Object(f.jsx)("div",{className:"control",children:Object(f.jsx)("button",{type:"reset",className:"button is-link is-light",onClick:function(){d(s)},children:"Clear"})})]})]})},R=(a(21),function(){return Object(f.jsx)("div",{className:"Loader","data-cy":"Loader",children:Object(f.jsx)("div",{className:"Loader__content"})})}),L=function(e){var t=e.post,a=Object(i.useContext)(v),s=a.state,c=a.dispatch,r=Object(i.useState)(!1),o=Object(n.a)(r,2),l=o[0],d=o[1];function j(e){var t;c({type:u.DELETE_COMMENT,payload:e}),t=e.id,h("/comments/".concat(t))}return Object(i.useEffect)((function(){s.selectedPost.id&&(c({type:u.IS_LOADING,payload:!0}),p(s.selectedPost.id).then((function(e){"error"in e&&c({type:u.SET_ERROR,payload:"error"}),c({type:u.SET_COMMENTS,payload:e}),c({type:u.IS_LOADING,payload:!0})})).catch((function(){return c({type:u.SET_ERROR,payload:"error"})})).finally((function(){return c({type:u.IS_LOADING,payload:!1})})))}),[t.id,s.selectedPost.id]),Object(f.jsx)("div",{className:"content","data-cy":"PostDetails",children:Object(f.jsxs)("div",{className:"content","data-cy":"PostDetails",children:[Object(f.jsxs)("div",{className:"block",children:[Object(f.jsxs)("h2",{"data-cy":"PostTitle",children:["#".concat(t.id,": "),t.title]}),Object(f.jsx)("p",{"data-cy":"PostBody",children:t.body})]}),Object(f.jsxs)("div",{className:"block",children:[s.isLoading&&Object(f.jsx)(R,{}),"error"===s.error&&Object(f.jsx)("div",{className:"notification is-danger","data-cy":"CommentsError",children:"Something went wrong"}),Object(f.jsx)("p",{className:"title is-4",children:"Comments:"}),s.comments.map((function(e){return Object(f.jsxs)("article",{className:"message is-small","data-cy":"Comment",children:[Object(f.jsxs)("div",{className:"message-header",children:[Object(f.jsx)("a",{href:e.email,"data-cy":"CommentAuthor",children:e.name}),Object(f.jsx)("button",{"data-cy":"CommentDelete",type:"button",className:"delete is-small","aria-label":"delete",onClick:function(){return j(e)},children:"delete button"})]}),Object(f.jsx)("div",{className:"message-body","data-cy":"CommentBody",children:e.body})]},e.id)})),s.showForm?Object(f.jsx)(P,{}):Object(f.jsx)("button",{"data-cy":"WriteCommentButton",type:"button",className:"button is-link",onClick:function(){d(!l),c({type:u.SHOWFORM,payload:!0})},children:"Write a comment"})]})]})})},D=function(){var e=Object(i.useState)([]),t=Object(n.a)(e,2),a=t[0],s=t[1],c=Object(i.useState)([]),r=Object(n.a)(c,2),o=r[0],d=r[1],j=Object(i.useContext)(v),b=j.state,m=j.dispatch;return Object(i.useEffect)((function(){O("/users").then((function(e){s(e)})).catch((function(){return m({type:u.SET_ERROR,payload:"error"})}))}),[]),Object(f.jsx)("main",{className:"section",children:Object(f.jsx)("div",{className:"container",children:Object(f.jsxs)("div",{className:"tile is-ancestor",children:[Object(f.jsx)("div",{className:"tile is-parent",children:Object(f.jsxs)("div",{className:"tile is-child box is-success",children:[Object(f.jsx)("div",{className:"block",children:Object(f.jsx)(_,{allUsers:a,setPosts:function(e){d(e)}})}),Object(f.jsxs)("div",{className:"block","data-cy":"MainContent",children:[Object(f.jsx)("p",{"data-cy":"NoSelectedUser",children:!b.selectedUser.id&&"No user selected"}),o.length>0&&Object(f.jsx)("div",{className:"tile is-child box is-success ",children:Object(f.jsx)(C,{usersPosts:o})}),b.isLoading&&Object(f.jsx)(R,{}),!(0!==o.length||!b.selectedUser.id||b.isLoading)&&Object(f.jsx)("div",{className:"notification is-warning","data-cy":"NoPostsYet",children:"No posts yet"}),"error"===b.error&&Object(f.jsx)("div",{className:"notification is-danger","data-cy":"PostsLoadingError",children:"Something went wrong!"})]})]})}),Object(f.jsx)("div",{"data-cy":"Sidebar",className:l()("tile","is-parent","is-8-desktop","Sidebar",{"Sidebar--open":b.selectedPost.id}),children:Object(f.jsx)("div",{className:"tile is-child box is-success ",children:Object(f.jsx)(L,{post:b.selectedPost})})})]})})})};c.a.render(Object(f.jsx)(g,{children:Object(f.jsx)(D,{})}),document.getElementById("root"))}},[[22,1,2]]]);
//# sourceMappingURL=main.413862ef.chunk.js.map